<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>3DPrintCraft | Магазин</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { --bg: #000c18; --card: #001f3f; --accent: #00d4ff; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: white; margin: 0; }
        header { background: var(--card); padding: 15px 5%; display: flex; justify-content: space-between; border-bottom: 2px solid var(--accent); align-items: center; }
        .container { padding: 40px 5%; max-width: 1000px; margin: auto; }
        .section { display: none; }
        .active { display: block; }
        .card { background: var(--card); padding: 20px; border-radius: 12px; border: 1px solid #1a3a5a; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; }
        button { background: var(--accent); color: #000; font-weight: bold; padding: 10px; border: none; border-radius: 6px; cursor: pointer; width: 100%; }
        input { width: 100%; padding: 10px; margin: 10px 0; background: #000; border: 1px solid #1a3a5a; color: white; border-radius: 6px; }
    </style>
</head>
<body>

<header>
    <div style="font-size: 24px; font-weight: bold; color: var(--accent);">3DPrintCraft</div>
    <div id="nav-info"></div>
</header>

<div class="container">
    <div id="auth-page" class="section active">
        <div class="card" style="max-width: 400px; margin: auto;">
            <h2>Вхід в магазин</h2>
            <input type="email" id="email" placeholder="Ваш Gmail">
            <button onclick="simpleAuth()">Увійти</button>
        </div>
    </div>

    <div id="catalog-page" class="section">
        <h2>Наші 3D Моделі</h2>
        <div id="catalog-grid" class="grid">Завантаження товарів...</div>
    </div>
</div>

<script>
    const supabaseUrl = 'https://kkyrhxuwllawvfqltgil.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtreXJoeHV3bGxhd3ZmcWx0Z2lsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg0MDMzNzUsImV4cCI6MjA4Mzk3OTM3NX0.r8DPctn9mF9EFLbU5_5cLrBcN-7oIo8p02BktKxKSVM';
    const _supabase = supabase.createClient(supabaseUrl, supabaseKey);

    // ПЕРЕВІРКА СЕСІЇ (Щоб не входити щоразу)
    window.onload = () => {
        const saved = localStorage.getItem('user_email');
        if(saved) loginSuccess(saved);
    };

    function simpleAuth() {
        const email = document.getElementById('email').value;
        if(email.includes('@')) {
            localStorage.setItem('user_email', email);
            loginSuccess(email);
        }
    }

    function loginSuccess(email) {
        document.getElementById('nav-info').innerText = email;
        showSection('catalog-page');
        loadProducts();
    }

    function showSection(id) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    async function loadProducts() {
        const { data: products, error } = await _supabase.from('products').select('*');
        const grid = document.getElementById('catalog-grid');
        grid.innerHTML = "";

        if(products) {
            products.forEach(p => {
                grid.innerHTML += `
                    <div class="card">
                        <div style="height:150px; background:url('${p.img}') center/cover; border-radius:8px; background-color:#000;"></div>
                        <h3>${p.name}</h3>
                        <p style="font-size:14px; color:#aaa;">${p.desc}</p>
                        <p><b>${p.price} грн</b></p>
                        <button onclick="alert('Додано в кошик!')">Замовити</button>
                    </div>`;
            });
        }
    }
</script>
</body>
</html>